const path=location.pathname;if(path.includes("newTask")){document.querySelector(".new-task__form").addEventListener("submit",addNewTask)}else if(path.includes("editTask"))editTask();else{renderCard();document.querySelector(".task-manager__sort").addEventListener("change",sortTasks)}function renderCard(){const e=document.querySelector(".task-manager__cards"),t=getLocalStorage("tasks");e.textContent="",t.forEach(({id:t,title:a,description:s,timestamp:n})=>{const r=new Date(+n),o=r.getFullYear(),d=addZero(r.getMonth()+1),l=addZero(r.getDate()),i=addZero(r.getHours()),c=addZero(r.getMinutes());e.insertAdjacentHTML("beforeend",`\n            <li class="task-card col-lg-4 col-md-6  w-100 mb-4 pr-3" data-idd="${t}" data-timestamp="${n}">\n                <div class="task-manager__card d-flex flex-column bg-white p-2 shadow-sm" tabindex="0">\n                    <h2 class="task-manager__card-title">${a}</h2>\n\n                    <time class="task-manager__card-date">\n                        ${o}.${d}.${l} в ${i}:${c}\n                    </time>\n\n                    <p class="task-manager__card-description">\n                        ${s}\n                    </p>\n\n                    <button class="task-manager__card-delete bg-danger border-0 text-white rounded">\n                        Удалить\n                    </button>\n\n                    <a class="task-manager__card-link" href="editTask.html#${t}">\n                        <i class="fas fa-pen-square"></i>\n                    </a>\n                </div>\n            </li>\n        `)});document.querySelectorAll(".task-manager__card-delete").forEach(e=>{e.addEventListener("click",e=>{const a=e.target.closest("li"),s=a.dataset.idd;let n=0;a.remove(),t.forEach((e,t)=>{e.id===s&&(n=t)}),t.splice(n,1),setLocalStorage("tasks",t)})})}function sortTasks(e){const t=e.target,a=document.querySelector(".task-manager__cards"),s=document.querySelectorAll(".task-card");let n;if("new"===t.value)n=[...s].sort((e,t)=>+e.dataset.timestamp-+t.dataset.timestamp);else{if("old"!==t.value)return void renderCard();n=[...s].sort((e,t)=>+t.dataset.timestamp-+e.dataset.timestamp)}a.textContent="";for(let e of n)a.insertAdjacentElement("beforeend",e)}function addNewTask(e){e.preventDefault();let t=this.title.value,a=this.description.value,s=new Date(this.date.value).getTime();console.log(s);let n=getLocalStorage("tasks"),r=document.querySelector(".new-task__message"),o={id:generateId(),title:t,description:a,timestamp:s};n.push(o),this.reset(),setLocalStorage("tasks",n),r.classList.add("created"),setInterval(()=>{r.classList.remove("created")},3e3)}function editTask(){const e=location.hash.slice(1),t=document.querySelector(".new-task__form"),a=document.querySelector(".new-task__message"),s=document.querySelector(".new-task__delete");let n=null,r=0,o=getLocalStorage("tasks");o.forEach((t,a)=>{t.id.includes(e)&&(n=t,r=a)});let d=new Date(n.timestamp);d=`${d.getFullYear()}-${addZero(d.getMonth()+1)}-${addZero(d.getDate())} ${addZero(d.getHours())}:${addZero(d.getMinutes())}`,t.title.value=n.title,t.description.value=n.description,t.dateTime.value=d,t.addEventListener("submit",e=>{e.preventDefault(),n.title=t.title.value,n.description=t.description.value,n.timestamp=new Date(t.dateTime.value).getTime(),o[r]=n,setLocalStorage("tasks",o),a.classList.add("created"),setInterval(()=>{a.classList.remove("created")},3e3)}),s.addEventListener("click",()=>{let a=getLocalStorage("tasks"),s=0;a.forEach((t,a)=>{t.id===e&&(s=a)}),a.splice(s,1),setLocalStorage("tasks",a),t.textContent="Задача была удалена"})}function getLocalStorage(e){return localStorage.getItem(e)?JSON.parse(localStorage.getItem(e)):[]}function setLocalStorage(e,t){localStorage.setItem(e,JSON.stringify(t))}function addZero(e){return e<10?"0"+e:e}function byteToHex(e){return("0"+e.toString(16)).slice(-2)}function generateHash(e=40){let t=new Uint8Array(e/2);return window.crypto.getRandomValues(t),Array.from(t,byteToHex).join("")}function generateId(){let e=generateHash();return getLocalStorage("tasks").forEach(t=>t.id.includes(e)?generateId():void 0),e}